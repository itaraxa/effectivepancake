# Задание по треку «Сервис сбора метрик и алертинга»
# Приложение **agent**
## Инкремент 2
Разработайте агент (HTTP-клиент) для сбора рантайм-метрик и их последующей отправки на сервер по протоколу HTTP.
Агент должен собирать метрики двух типов:
- Тип gauge, float64.
- Тип counter, int64.

В качестве источника метрик используйте пакет runtime.
Нужно собирать следующие метрики типа gauge:
- Alloc
- BuckHashSys
- Frees
- GCCPUFraction
- GCSys
- HeapAlloc
- HeapIdle
- HeapInuse
- HeapObjects
- HeapReleased
- HeapSys
- LastGC
- Lookups
- MCacheInuse
- MCacheSys
- MSpanInuse
- MSpanSys
- Mallocs
- NextGC
- NumForcedGC
- NumGC
- OtherSys
- PauseTotalNs
- StackInuse
- StackSys
- Sys
- TotalAlloc

К метрикам пакета runtime добавьте ещё две:
- PollCount (тип **counter**) — счётчик, увеличивающийся на 1 при каждом обновлении метрики из пакета runtime (на каждый `pollInterval` — см. ниже).
- RandomValue (тип **gauge**) — обновляемое произвольное значение.

По умолчанию приложение должно:
- Обновлять метрики из пакета `runtime` с заданной частотой: `pollInterval` — 2 секунды.
- Отправлять метрики на сервер с заданной частотой: `reportInterval` — 10 секунд.

Чтобы приостанавливать работу функции на заданное время, используйте вызов `time.Sleep(n * time.Second)`. Подробнее о пакете time и его возможностях вы узнаете в третьем спринте.
Метрики нужно отправлять по протоколу HTTP методом POST:
- Формат данных — `http://<АДРЕС_СЕРВЕРА>/update/<ТИП_МЕТРИКИ>/<ИМЯ_МЕТРИКИ>/<ЗНАЧЕНИЕ_МЕТРИКИ>`.
- Адрес сервера — `http://localhost:8080`.
- Заголовок — `Content-Type: text/plain`.

Пример запроса к серверу:
```
POST /update/counter/someMetric/527 HTTP/1.1
Host: localhost:8080
Content-Length: 0
Content-Type: text/plain
```
Пример ответа от сервера:
```
HTTP/1.1 200 OK
Date: Tue, 21 Feb 2023 02:51:35 GMT
Content-Length: 11
Content-Type: text/plain; charset=utf-8
```

Покройте код агента и сервера юнит-тестами.

# Инкремент 4
Доработайте код, чтобы он умел принимать аргументы с использованием флагов.
- Аргументы агента:
  - Флаг `-a=<ЗНАЧЕНИЕ>` отвечает за адрес эндпоинта HTTP-сервера (по умолчанию `localhost:8080`).
  - Флаг `-r=<ЗНАЧЕНИЕ>` позволяет переопределять `reportInterval` — частоту отправки метрик на сервер (по умолчанию 10 секунд).
  - Флаг `-p=<ЗНАЧЕНИЕ>` позволяет переопределять `pollInterval` — частоту опроса метрик из пакета runtime (по умолчанию 2 секунды).
- При попытке передать приложению неизвестные флаги оно должно завершаться с сообщением о соответствующей ошибке.
- Значения интервалов времени должны задаваться в секундах.
- Во всех случаях должны присутствовать значения по умолчанию.

# Инкремент 5
Доработайте агент, чтобы он мог изменять свои параметры запуска по умолчанию через переменные окружения:
- `ADDRESS` отвечает за адрес эндпоинта HTTP-сервера.
- `REPORT_INTERVAL` позволяет переопределять `reportInterval`.
- `POLL_INTERVAL` позволяет переопределять `pollInterval`.
- Значения интервалов времени должны задаваться в секундах.

# Инкремент 7
Для передачи метрик на сервер используйте Content-Type: `application/json`. В теле запроса должен быть описанный выше JSON. Передавать метрики нужно через `POST` `update/`. В теле ответа отправляйте JSON той же структуры с актуальным (изменённым) значением Value. 
Для получения метрик с сервера также используйте Content-Type: `application/json`. В теле запроса должен быть описанный выше JSON с заполненными полями ID и MType. Запрашивать нужно через `POST` `value/`. В теле ответа должен приходить такой же JSON, но с уже заполненными значениями метрик. 
Переведите агент на новый API.
Автотесты проверяют, что агент экспортирует и обновляет на сервере метрики, описанные в первых инкрементах.

# Инкремент 8
Добавьте поддержку **gzip** в код сервера и агента. Научите:
- Агент передавать данные в формате **gzip**.
Функция сжатия должна работать для контента с типами `application/json` и `text/html`.